<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="report_treatment_plan_pdf">
    <t t-call="web.html_container">
    <t t-call="web.external_layout">
		<t t-foreach="docs" t-as="o">
    <div class="page">
        <div class="text-center">
            <div style="color:#009688;">
                 <h2><b>Treatment Plan</b></h2>
             </div>
            <table style="width:100%;">
                        <tr>
                            <th style="width:60%;"></th>
                            <th style="width:40%;"></th>
                        </tr>
					    <tr>
                            <td>
                                <div style="color:#009688;"><strong>Patient Name : </strong></div>
                                <p t-if="o.patient_name" t-field="o.patient_name"/></td>
                            <td>
                                <div style="color:#009688;"><strong>Doctor Name : </strong></div>
                                <p t-if="o.doctor" t-field="o.doctor"/></td>
                        </tr>
					    <tr>
                            <td>
                                <div style="color:#009688;"><strong>Appointment : </strong></div>
                                <p t-field="o.name"/></td>
                            <td>
                                <div style="color:#009688;"><strong>Date Approved : </strong></div>
                                <p t-if="o.treatment_plan_date" t-field="o.treatment_plan_date"/></td>
					    </tr>
            </table>
            <table class="table table-bordered table-striped"  style="width: 100%">
                <thead>
                    <th style='color:white;background-color: #009688;text-align:center;border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;border-bottom:1px solid #000000;' width='7%'>Sl No.</th>
                    <th style="color:white;background-color: #009688;border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;border-bottom:1px solid #000000;" width='20%'>Diagnosis</th>
                    <th style="color:white;background-color: #009688;border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;border-bottom:1px solid #000000;" width='20%'>Description</th>
                    <th style="color:white;background-color: #009688;border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;border-bottom:1px solid #000000;" width='8%'>Tooth</th>
                    <th style="color:white;background-color: #009688;border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;border-bottom:1px solid #000000;" width='10%'>Surface</th>
                    <th style="color:white;background-color: #009688;border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;border-bottom:1px solid #000000;" width='17%'>Actual Amount</th>
                    <th style="color:white;background-color: #009688;border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;border-bottom:1px solid #000000;" width='17%'>After Disc.</th>
                    <th style="color:white;background-color: #009688;border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;border-bottom:1px solid #000000;" width='17%'>Payment by Patient</th>
                </thead>
                <tbody>
                    <t t-set="i" t-value="1" />
                    <t t-set="amt_total" t-value="0" />
                    <t t-set="disc_total" t-value="0" />
                    <t t-set="patient_total" t-value="0" />
                    <t t-set="i" t-value="1" />
                    <tr t-foreach="o.operations" t-as="l">
                        <td style='text-align:center;border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;border-bottom:1px solid #000000;'><span t-esc="i"/><t t-set="i" t-value="i+1"/></td>
                        <td style="border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;border-bottom:1px solid #000000;"><span t-if="l.diagnosis_id" t-field="l.diagnosis_id"/></td>
                        <td style="border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;border-bottom:1px solid #000000;"><span t-if="l.description" t-field="l.description"/></td>
                        <td style="border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;border-bottom:1px solid #000000;"><span t-if="l.teeth_id" t-field="l.teeth_id"/></td>
                        <td style="border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;border-bottom:1px solid #000000;"><span t-if="l.detail_description" t-field="l.detail_description"/></td>
                        <td style="border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;border-bottom:1px solid #000000;"><span t-if="l.actual_amount" t-field="l.actual_amount"/><t t-set="amt_total" t-value="l.actual_amount+amt_total"/></td>
                        <td style="border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;border-bottom:1px solid #000000;"><span t-if="l.amount" t-field="l.amount"/><t t-set="disc_total" t-value="l.amount+disc_total"/></td>
                        <td style="border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;border-bottom:1px solid #000000;"><span t-if="l.amt_to_be_patient" t-field="l.amt_to_be_patient"/><t t-set="patient_total" t-value="l.amt_to_be_patient+patient_total"/></td>
                    </tr>
                    <tr>
                        <td colspan="5" style="border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;border-bottom:1px solid #000000;"><strong>Total</strong></td>
                        <td style="border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;border-bottom:1px solid #000000;"><strong><span t-esc="amt_total"/></strong></td>
                        <td style="border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;border-bottom:1px solid #000000;"><strong><span t-esc="disc_total"/></strong></td>
                        <td style="border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;border-bottom:1px solid #000000;"><strong><span t-esc="patient_total"/></strong></td>
                    </tr>
                </tbody>
            </table>



            <div class="text-left">
                <span t-raw="o.company_id.treatment_plan_content"/>
            </div>
            <div t-if="o.plan_signature" class="pull-right">
                <strong>Patient Signature</strong>
                <br/>
                <img t-if="o.plan_signature" t-att-src="'data:image/png;base64,%s' % to_text(o.plan_signature)" class="pull-right" height="60"/>
            </div>

        </div>
    </div>
    </t>
    </t>
    </t>
</template>


    <report
        id="report_treatment_plan2_pdf"
        string="Treatment Plan"
        model="medical.appointment"
        report_type="qweb-pdf"
		file="pragtech_dental_management.report_treatment_plan_pdf"
        name="pragtech_dental_management.report_treatment_plan_pdf"
		menu="False"
    />


    <record id="view_treatment_plan" model="ir.ui.view">
            <field name="name">treatment.plan.wizard.form</field>
            <field name="model">treatment.plan.wizard</field>
            <field name="priority">24</field>
            <field name="arch" type="xml">
                <form>
                    <center><h3>Treatment Plan</h3></center>
                    <field name="company_id" invisible="1"/>
                    <br/>
                    <table style="width:100%;">
                        <tr>
                            <th style="width:60%;"></th>
                            <th style="width:40%;"></th>
                        </tr>
					    <tr>
						    <td><label for="patient" string="Patient Name : "/><field name="patient"/></td>
						    <td><label for="doctor" string="Doctor Name : "/><field name="doctor"/></td>
                        </tr>
					    <tr>
						    <td><label for="appt_id" string="Appointment : "/><field name="appt_id"/></td>
						    <td><label for="updated_date" string="Date Approved : "/><field name="updated_date"/></td>
					    </tr>
                    </table>
                    <br/>
                    <field name="operations" readonly="1">
                        <tree>
                            <field name="appt_id" invisible="1"/>
                            <field name="create_date" invisible="1"/>
                            <field name="diagnosis_id" readonly="0"/>
                            <field name="diagnosis_description" invisible="1"/>
                            <field name="description" />
                            <field name="teeth_id" />
                            <field name="state" invisible="1"/>
                            <field name="dentist" invisible="1"/>
                            <field name="detail_description" />
                            <field name="actual_amount"/>
                            <field name="discount_fixed_percent"
                                   groups="pragtech_dental_management.group_enable_discount_in_payment_lines"/>
                            <field name="discount" attrs="{'readonly':[('discount_fixed_percent','!=','Percent')]}"
                                   groups="pragtech_dental_management.group_enable_discount_in_payment_lines"/>
                            <field name="discount_value" attrs="{'readonly':[('discount_fixed_percent','!=','Fixed')]}"
                                   groups="pragtech_dental_management.group_enable_discount_in_payment_lines"/>
                            <field name="amount" readonly="1" force_save="1"
                                   groups="pragtech_dental_management.group_enable_discount_in_payment_lines"/>
                            <field name="amount" sum="Total after Discount"/>
                            <field name="amt_to_be_patient" sum="Payment by Patient"/>
                        </tree>
                    </field>
                    <br/>
                    <br/>
                    <br/>
                    <br/>
                    <br/>
                    <field name="treatment_plan_content" readonly="1"/>
                    <field name="plan_signature" widget="signature" nolabel="1"/>
                    <footer>
                        <button name="action_confirm" string="Confirm" type="object" class="btn-primary"/>
                        <button string="Cancel" class="btn-default" special="cancel" />
                    </footer>
                </form>
            </field>
    </record>

	<record model="ir.actions.act_window" id="action_treatment_plan_wizard">
		<field name="name">Treatment Plan Form</field>
		<field name="type">ir.actions.act_window</field>
		<field name="res_model">treatment.plan.wizard</field>
		<field name="view_type">form</field>
		<field name="view_mode">form</field>
		<field name="target">new</field>
        <field name="context">{
            'default_appt_id': active_id}
        </field>
	</record>

</odoo>